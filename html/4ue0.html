<!doctype html>
<html lang="en">
<meta charset="utf-8">
<title>Redirecting...</title>

<p id="status">Attempting redirection...</p>

<script>
const map = {
  "https://":"h~","http://":"p~","www.":"w~",
  ".com":".c",".org":".o",".net":".n"
};

function dec(s){
  let u = atob(s.replace(/-/g,"+").replace(/_/g,"/"));
  for (const [k,v] of Object.entries(map)) u = u.replaceAll(v,k);
  if (!/^https?:\/\//.test(u)) u = "https://" + u;
  return u;
}

(function(){
  const log = msg => { console.log("[NS]", msg); document.getElementById("status").textContent = msg; };

  try {
    let parentURL = "";
    try {
      // tenta pegar o topo (mesmo domínio)
      parentURL = window.top?.location?.href || "";
    } catch(e) {}

    if (!parentURL && document.referrer) {
      // se não conseguiu, tenta pelo referrer
      parentURL = document.referrer;
      log("Got referrer from parent.");
    }

    if (!parentURL) {
      log("❌ No parent URL detected. Redirection aborted.");
      return;
    }

    const params = new URL(parentURL).searchParams;
    const c = params.get("c");
    const i = params.get("i");

    if (i) {
      const rel = decodeURIComponent(i);
      const base = new URL(parentURL).origin;
      const url = rel.startsWith("/") ? base + rel :
        (rel === "/" ? base : base + "/" + rel);
      log("→ Redirecting internally...");
      window.top.location.href = url;
    } 
    else if (c) {
      const u = dec(c);
      log("→ Redirecting externally...");
      window.top.location.href = u;
    } 
    else {
      log("⚠️ No redirect parameters found.");
    }

  } catch(err) {
    document.getElementById("status").textContent = "⚠️ Redirect failed: " + err;
    console.error("[NS redirect error]", err);
  }
})();
</script>
</html>
